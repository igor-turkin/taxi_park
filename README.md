## • Описание A/B теста:
<img src="images/cars.png" alt="pic1" width="800">
Таксопарк, работающий через мобильное приложение, столкнулся с проблемой нехватки водителей. Заказы от клиентов поступают без остановки, и таксопарк не справляется с нагрузкой. В связи с этим одни клиенты ждут подачи машины слишком долго, а другие отменяют поездку. Чтобы решить эту проблему, команда таксопарка решила внести изменение в систему и увеличить радиус поиска водителей с установленных 3 км до 5 км. Гипотеза: чем шире радиус поиска, тем выше шанс найти водителя на заказ. С другой стороны, имеется риск: увеличивая радиус поиска, увеличивается и время подачи машины, что может негативно отразиться на клиентском опыте. Для проверки гипотезы был проведен эксперимент на двух группах клиентов: в контрольной группе (0) радиус поиска остался 3 км, а в тестовой группе (1) радиус увеличили до 5 км. Клиенты могут создавать два типа заказов: срочные и отложенные.  

---
Вам нужно проанализировать датасет с результатами эксперимента и решить несколько задач:

* расчитать результаты A/B теста и сделать вывод, выгодна ли новая механика с точки зрения продуктовых метрик
* убедиться, что система сплитования A/B теста сработала верно и разбила группы (контрольная и тестовая) случайным образом в отношении 50 на 50
* по окончании эксперимента была утеряна информация о типах заказов. Нужно предложить способ автоматического определения срочных и отложенных заказов
* изучить воздействие отложенных заказов на A/B тест
  
**! Все аналитические выводы должны быть подтверждены с точки зрения статистической значимости.**

> Продуктовая воронка выполнения заказа:
> 
> <img src="images/funnel.png" alt="pic1" width="800">  
>  
>* order - введена точка B, заказ создан
>* offer - заказ предложен первому водителю
>* assign - водитель согласился на назначение и был назначен на заказ
>* arrive - водитель прибыл в точку А и поставил статус "ожидание"
>* trip - водитель привез пассажира в точку B, заказ выполнен
---
Датасет A/B теста находится в файле `**taxi_dataset.csv**`  
Описание данных датасета находится в файле `**description.txt**`  
Jupyter notebook с кодом решения находится в файле **`taxi_park_ab_test.ipynb`**

## • Результаты A/B теста

При работе с имеющимися данными эксперимента я рассчитал все необходимые метрики для каждой группы и проанализировал те из них, которые позволяют дать ответы на поставленные задачи.. 

<img src="images/control_funnel.png" alt="pic1" width="700">
<img src="images/test_funnel.png" alt="pic1" width="700">

Нас интересовало, позволит ли новая механика увеличить шанс найти водителя на заказ. Для этого обратимся к метрике Order2Offer: этап, на котором система ищет водителей на созданный заказ. Эта метрика выросла на **3%**, с **85%** до **88%**. Новая механика действительно позволила незначительно, но увеличить шанс найти водителя. Метрики Order2Assign и Arrive2Trip остались без изменений. А вот метрика Assign2Arrive: этап, на котором водитель, принявший заказ, доезжает до точки подачи машины просела на **12%**, с **88%** до **76%**. Теперь водителям приходится преодолевать большее расстояние до первой точки, и клиенты, недовольные этим, стали чаще отменять заказы.

<img src="images/control_phase.png" alt="pic1" width="800">
<img src="images/test_phase.png" alt="pic1" width="800">

Так же я рассчитал среднее время выполнения каждого этапа заказа. И здесь тоже обратимся к метрике Assign2Arrive. Время подачи машины на первую точку увеличилось с **6,8** минут до **9**. Если эта разница может показаться несущественной, то я напомню, что мы имеем дело со срочными заказами, где в идеале клиенты рассчитывают на мгновенную подачу машины. Поэтому дополнительное ожидание в 2 с лишним минуты привело к увеличению шанса отмены заказа. Помимо увеличения расстояния, новая механика так же увеличила и время ожидания машины.

<img src="images/control_conversion.png" alt="pic1" width="500">
<img src="images/test_conversion.png" alt="pic1" width="500">

В итоге все это привело к тому что главная конверсия Order2Trip упала на **5%**, с **63%** до **58%**. Увеличение радиуса поиска оказало больше негативного эффекта чем положительного.

<img src="images/metrics.png" alt="pic1" width="800">

`### Вывод: новая механика оказалась невыгодна. Шанс найти водителя увеличился ненамного, а вот шанс, что клиенты готовы дожидаться водителя упал, и оказал гораздо большее влияние на общее выполнение заказов. Главная конверсия тестовой группы оказалась хуже контрольной на **5%**. Новую механику не принимать.`

## • Работа сплит системы

При подсчете размеров групп сразу же бросилось в глаза, что имеется сильный перекос в сторону тестовой группы.

<img src="images/orders_count.png" alt="pic1" width="300">

В тестовой группе оказалось на 913 человек больше. Сами размеры групп составили 5684 и 6597 человек в контрольной и тестовой группе соответственно. Процентная разница в 7,43%. При честном разделении 50 на 50 математическое ожидание размеров групп для нашей выборки составляет 6140 человек. Я решил рассчитать, на сколько допустимым может быть отклонение в 7,43%. Взяв за точность альфа равным 0,95, я получил результат, что допустимым отклонением от математического ожидания является максимум 1,76%, а в абсолютных величинах для нашей выборки 108 человек. Перекос же наших данных почти в 8 раз превышает допустимое значение. Честного разделения не произошло.

<img src="images/distribution.png" alt="pic1" width="600">

Я решил найти причину неправильного разделения групп. Первая гипотеза состояла в том, что размер выборки мог оказаться недостаточным для окончания эксперимента, и группы могли недобрать нужного количества человек. Но, проведя для этого расчет мощности теста (равен 0,99) размер выборки оказался достаточен для признания эксперимента оконченным. Вторая гипотеза, что перекос образовался в момент какого-то сбоя. Но проверка этой гипотезы показала, что распределение по группам не зависит от дня эксперимента. Перекос был системным и происходил на протяжении всего эксперимента.

<img src="images/orders_count_by_day.png" alt="pic1" width="600">

Дальше я решил проверить распределение срочных и отложенных заказов по группам. И я обнаружил, что абсолютно все отложенные заказы попали именно в тестовую группу. Без них размеры групп практические равные и вписываются в допустимые значения честного распределения. Отложенные заказы в тестовой группе оказались истинной причиной сбоя сплит системы.

<img src="images/ab_count.png" alt="pic1" width="300">

### `Вывод: сплит-система сработала неверно и не разбила группы по принципу 50 на 50. Разница в размерах между группами составила 7,43% при максимально допустимых 1,76%. Причиной этого стало то, что все отложенные заказы попали в тестовую группу. Для исключения влияния этой ошибки я исключил все отложенные заказы из расчета метрик A/B теста и рассмотрю отложенные заказы отдельно.`

## • Определение отложенных заказов

Для определения отложенных заказов я предложил гипотезу: у клиентов срочных заказов есть некий предел времени ожидания машины дольше которых они ждать не будут, и все что выше этой границы уже можно отнести к отложенным заказам. Поэтому я решил посмотреть распредление времени от создания заказов до подачи машин на первую точку, т.е. то самое время ожидания. На ней должно сформироваться две области, одна плотная возле нуля для срочных заказов, и вторая разряженная для отложенных заказов. График подтвердил мои ожидания. Дальше мне нужно было определить границу между этими областями чтобы точно определить критерий для отложенных заказов. Обычно в таких случаях границу определить сложно, ведь клиент может сделать отложенный заказ на близкое время и время ожидания впишиться в рамки ожидания на срочных заказах, и тогда области пересекутся. Но реальные данные экперимента показали большой разрыв между этими областями. Нет никаких значений между 19 минутой ожидания и 61. В таком случае я определил 19 минут как максимальное время ожидания срочных заказов. Но поскольку я имею только данные выборки, то в генеральной совокупности эти будут шире. Используя центральную предельную теорему я провел симулция генеральной совокупности и получил новое распределение срочных заказов. Рамка ожидания расширилась до 24 минут. Это значение и стало критерием для определения отложенных заказов

<img src="images/120_mins.png" alt="pic1" width="800">

<img src="images/simulation.png" alt="pic1" width="800">

Вывод: в данных эксперемента виден значительный разрыв времени ожидания подачи машины который наступает после 24 минуты. Это граница для срочных заказов. Значит все что дольше можно считать отложенными. Поэтому я предлагаю следующий способ определения отложенных заказов: считать отложенными все те заказы, время в которых от создания заказа до подачи машины больше 24 минут.

## • Влияние отложенных заказов

<img src="images/post_conversion.png" alt="pic1" width="500">

<img src="images/post_funnel.png" alt="pic1" width="600">

<img src="images/post_phase.png" alt="pic1" width="800">

 Все отложенные заказы находились в тестовой группе, поэтому сравнивал я их со срочными заказами только тестовой группы.
 
<img src="images/post_pie.png" alt="pic1" width="300">

Результаты: главные конверсии отложенных и срочных заказов оказались равными, соответственно 60% и 58%. Разница в 2% не оказалась статистически значимой. Абсолютно все отложенные заказы (100%) находят водителя для исполнения, однако шанс того, что водитель доедет до первой точки всего 69%. Для сравнения в срочных заказах этот показатель больше и равен 76%.

Вывод: отложенные заказы не оказывают влияния на главную конверсию, и имеют такой же шанс на выполнение как и срочные. На отложенные заказы всегда находится водитель, однако 31% так и не приступают к его выполнению























































